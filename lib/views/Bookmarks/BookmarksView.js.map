{"version":3,"file":"BookmarksView.js","sourceRoot":"","sources":["../../../src/views/Bookmarks/BookmarksView.ts"],"names":[],"mappings":"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","sourcesContent":["'use babel'\n\n/*!\n * Dynamic Engine Workbench\n * Copyright(c) 2017 Dynamic Engine Team @ Vipera Plc\n * MIT Licensed\n */\n\n import {\n   createText,\n   createElement,\n   insertElement,\n   createGroupButtons,\n   createButton,\n   createIcon,\n   createIconFromPath,\n   attachEventFromObject,\n   createTextEditor\n } from '../../element/index';\n\nimport { EventBus } from '../../DEWorkbench/EventBus'\nimport { EventEmitter }  from 'events'\nimport { ProjectManager } from '../../DEWorkbench/ProjectManager'\nimport { UIPane } from '../../ui-components/UIPane'\nimport { UIListView, UIListViewModel } from '../../ui-components/UIListView'\nimport { Logger } from '../../logger/Logger'\nimport { UITabbedView, UITabbedViewItem, UITabbedViewTabType } from '../../ui-components/UITabbedView'\nimport { BookmarkManager, Bookmark } from '../../DEWorkbench/BookmarkManager'\nimport { UIExtendedListView, UIExtendedListViewModel, UIExtendedListViewValidationResult } from '../../ui-components/UIExtendedListView'\nimport { DEWorkbench } from '../../DEWorkbench/DEWorkbench'\n\nconst _ = require(\"lodash\")\nconst cliTruncate = require('cli-truncate');\n\nexport class BookmarksView extends UIPane {\n\n  listView:UIExtendedListView;\n  model:UIExtendedListViewModel;\n\n  constructor(params:any){\n    super(params)\n    console.log(\"BookmarksView creating for \",this.paneId);\n  }\n\n  protected createUI():HTMLElement {\n\n    this.model = new BookmarksModel();\n    this.listView = new UIExtendedListView(this.model).setCellSelectable(false);\n\n    let el = createElement('div', {\n        elements: [\n          this.listView.element()\n        ],\n        className: 'de-workbench-bookmarks-view'\n    });\n\n\n    return el;\n  }\n\n\n  public destroy(){\n    this.listView.destroy()\n    this.model.destroy()\n    this.listView = null;\n    this.model = null;\n    super.destroy();\n  }\n\n}\n\nclass BookmarksModel implements UIExtendedListViewModel {\n\n  public static get COL_ACTION():number { return 0; }\n  public static get COL_RESOURCE():number { return 1; }\n  public static get COL_LINENO():number { return 2; }\n\n  bookmarks:Array<Bookmark>\n  events:EventEmitter;\n\n  constructor(){\n    this.events = new EventEmitter();\n    this.bookmarks = BookmarkManager.getInstance().getBookmarks();\n\n    EventBus.getInstance().subscribe(BookmarkManager.EVT_BOOKMARK_ADDED,(eventData)=>{\n      this.onBookmarkAdded(eventData[0])\n    })\n    EventBus.getInstance().subscribe(BookmarkManager.EVT_BOOKMARK_REMOVED,(eventData)=>{\n      this.onBookmarkRemoved(eventData[0])\n    })\n  }\n\n  protected onBookmarkAdded(bookmark){\n    this.events.emit('didModelChanged', this)\n  }\n\n  protected onBookmarkRemoved(bookmark){\n    _.remove(this.bookmarks, {\n        id: bookmark.id\n    });\n    this.events.emit('didModelChanged', this)\n  }\n\n  hasHeader():boolean{\n    return true;\n  }\n\n  getRowCount():number {\n    return this.bookmarks.length;\n  }\n\n  getColCount():number {\n    return 3;\n  }\n\n  isCellEditable(row:number, col:number):boolean {\n    return false;\n  }\n\n  onValueChanged(row:number, col:number, value:any){\n  }\n\n  onEditValidation(row:number, col:number, value:any):UIExtendedListViewValidationResult {\n    return null;\n  }\n\n\n  getElementAt(row:number, col:number):HTMLElement {\n    let bookmark:Bookmark = this.bookmarks[row];\n    //let filePathValue = cliTruncate(bookmark.filePath, 50, {position: 'start'});\n    let filePathValue  = bookmark.filePath;\n    if (col===BookmarksModel.COL_RESOURCE){\n      let el = createElement('a',{\n        elements: [ createText(filePathValue)]\n      })\n      el.setAttribute('href','#')\n      el.setAttribute('bookmark_id',bookmark.id)\n      el.addEventListener('click',(evt)=>{\n        this.onBookmarkClicked(evt.target.getAttribute('bookmark_id'));\n      })\n      return el;\n    } else if (col===BookmarksModel.COL_LINENO) {\n      let el = createElement('a',{\n        elements: [ createText(\"\"+(bookmark.lineNumber+1)) ]\n      })\n      return el;\n    } else if (col===BookmarksModel.COL_ACTION) {\n      let el = createElement('span',{\n        elements: [ ],\n        className: 'icon icon-remove-close'\n      })\n      el.setAttribute('bookmark_id',bookmark.id)\n      el.addEventListener('click',(evt)=>{\n        this.onBookmarkDeleteClicked(evt.target.getAttribute('bookmark_id'));\n      })\n      return el;\n    }\n  }\n\n  protected onBookmarkDeleteClicked(bookmarkId:string){\n    this.events.emit(\"onDidBookmarkDeleteClick\", bookmarkId)\n    let deleted = BookmarkManager.getInstance().deleteBookmarkById(bookmarkId);\n    if (deleted){\n      this.events.emit('didModelChanged', this)\n    }\n  }\n\n  protected onBookmarkClicked(bookmarkId:string){\n      this.events.emit(\"onDidBookmarkClick\", bookmarkId)\n      let bookmark = BookmarkManager.getInstance().getBookmarkById(bookmarkId);\n      if (bookmark){\n        atom.workspace.open(bookmark.filePath, {\n                    initialLine: bookmark.lineNumber,\n                    initialColumn: 0\n                });\n      }\n  }\n\n  getValueAt(row:number, col:number):any {\n    let bookmark:Bookmark = this.bookmarks[row];\n    if (col===BookmarksModel.COL_RESOURCE){\n      return cliTruncate(bookmark.filePath, 20, {position: 'start'});\n    } else if (col===BookmarksModel.COL_LINENO){\n      return (bookmark.lineNumber+1)\n    } else if (col===BookmarksModel.COL_ACTION){\n      return \"-\"\n    } else {\n      return \"Unknown column\"\n    }\n  }\n\n  getTitleAt(row:number, col:number):any {\n    let bookmark:Bookmark = this.bookmarks[row];\n    if (col===BookmarksModel.COL_RESOURCE){\n      return bookmark.filePath;\n    } else if (col===BookmarksModel.COL_LINENO){\n      return (bookmark.lineNumber+1)\n    } else if (col===BookmarksModel.COL_ACTION){\n      return null\n    } else {\n      return \"Unknown column\"\n    }\n  }\n\n  getClassNameAt(row:number, col:number):string{\n    if (col===BookmarksModel.COL_LINENO){\n      return \"de-workbench-bookmark-list-lineno\"\n    }\n    else if (col===BookmarksModel.COL_ACTION){\n      return \"de-workbench-bookmark-list-action\"\n    }\n    return null;\n  }\n\n  getColumnName(col:number):string {\n      if (col===BookmarksModel.COL_RESOURCE){\n        return \"Resource\"\n      } else if (col===BookmarksModel.COL_LINENO){\n        return \"Line no.\"\n      } else if (col===BookmarksModel.COL_ACTION){\n        return \"\"\n      }\n  }\n\n  getClassName():string {\n    return \"\"\n  }\n\n  addEventListener(event:string, listener){\n    this.events.addListener(event, listener)\n  }\n  removeEventListener(event:string, listener){\n    this.events.removeListener(event, listener)\n  }\n\n  destroy(){\n    this.events.removeAllListeners();\n  }\n\n}\n"]}